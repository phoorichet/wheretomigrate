
<div id="panel">
  <form id="mainform">
    <h1>Migrant Heaven</h1>
    <form id="mainForm">
      View factor:
      <select name="factorList" onchange="factorOnChange(this)">
        <option value="jobs">Job openings</option>
        <option value="crime">Crime rates</option>
        <option value="costoflivings">Cost of livings</option>
        <option value="races">Races</option>
      </select>
    </form>
  </form>
</div>
<div id="map-canvas"></div>

<script>

  var data;

  function initialize() {
    var initLatLng = new google.maps.LatLng(39.061849,-97.697296); // USA
    map = new google.maps.Map(document.getElementById('map-canvas'), {
      zoom: 5,
      center: initLatLng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    });

    getData("jobs");
  }

  function getData(factor_name) {
    var sf = 1;
    if (factor_name === "jobs") {
      sf = 1;
    } else if (factor_name === "crime") {
      sf = 0.2;
    } else if (factor_name === "costoflivings") {
      sf = 1;
    } else if (factor_name === "races") {
      sf = 0.8;
    }

    data = [
      {
        lat: 39.061849,
        lng: -97.697296,
        size: 1,
        size: (1*sf),
        html: "123"
      },
      {
        lat: 43.229195,
        lng: -110.177765,
        size: 0.8,
        size: (0.8*sf),
        html: "456"
      }
    ];
    // $.ajax({
    //   url: factor_name+".json",
    //   cache: false,
    //   success: function (data, textStatus, jqXHR) {
    //     updateMap(data);
    //   },
    //   dataType: 'json',
    // });

    updateMap(data);
  }

  var clusterMarkers = [];
  function updateMap(data) {
    // Clear cluster markers
    for (i=0; i<clusterMarkers.length; i++) {
      clusterMarkers[i].setMap(null);
    }
    clusterMarkers = [];

    for (var i=0; i<data.length; i++) {
      // Draw device's position
      clusterMarkers[i] = new google.maps.Circle({
        map: map,
        // strokeColor: color[data[i].member_count],
        strokeColor: '#f00',
        strokeOpacity: 1.0,
        strokeWeight: 1,
        // fillColor: color[data[i].member_count],
        fillColor: '#0f0',
        fillOpacity: 0.2,
        center: new google.maps.LatLng(data[i].lat, data[i].lng),
        radius: parseInt(data[i].size*200000),
      });

      var infowindow = new google.maps.InfoWindow({
        position: new google.maps.LatLng(data[i].lat, data[i].lng),
        content: clusterMarkers[i].html
      });

      google.maps.event.addListener(clusterMarkers[i], 'click', function() {
        infowindow.open(map,clusterMarkers[i]);
      });
    }
  }

  /* Initial Google Maps after the page is loaded */
  google.maps.event.addDomListener(window, 'load', initialize);

  function factorOnChange(f) {
    getData(f.value);
  }

</script>